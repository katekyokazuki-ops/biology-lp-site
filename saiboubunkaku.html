import React, { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, BookOpen, AlertTriangle, CheckCircle, Info } from 'lucide-react';

const SlideDeck = () => {
  const [currentSlide, setCurrentSlide] = useState(0);
  const [showAnswer, setShowAnswer] = useState({ 1: false, 2: false, 3: false });

  const totalSlides = 9;

  const nextSlide = () => {
    if (currentSlide < totalSlides - 1) {
      setCurrentSlide(curr => curr + 1);
    }
  };

  const prevSlide = () => {
    if (currentSlide > 0) {
      setCurrentSlide(curr => curr - 1);
    }
  };

  // Keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'ArrowRight') nextSlide();
      if (e.key === 'ArrowLeft') prevSlide();
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [currentSlide]);

  const toggleAnswer = (num) => {
    setShowAnswer(prev => ({ ...prev, [num]: !prev[num] }));
  };

  // Slide Content Components
  const Slide1 = () => (
    <div className="flex flex-col items-center justify-center h-full text-center space-y-8">
      <div className="bg-blue-100 text-blue-800 px-6 py-2 rounded-full font-bold text-sm tracking-widest">
        高校生物 / 大学受験対策
      </div>
      <h1 className="text-5xl font-black text-slate-800 leading-tight">
        細胞をバラバラにして<br />正体暴く！<br />
        <span className="text-blue-600">「細胞分画法」</span>
      </h1>
      <p className="text-2xl text-slate-500 font-medium">
        ～ もう迷わない！沈殿の順番と3つの必須条件 ～
      </p>
      <div className="mt-12 text-lg text-slate-400">
        講師：日本一の生物講師ブラザーズ
      </div>
    </div>
  );

  const Slide2 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-8 border-b-4 border-blue-200 pb-2 inline-block w-full">
        導入：なぜ「分画」するの？
      </h2>
      <div className="flex justify-around items-center mb-8">
        <div className="text-center p-6 bg-gray-100 rounded-xl w-1/3">
          <div className="text-6xl mb-4">🍲</div>
          <p className="font-bold text-lg">細胞の中は<br/>「闇鍋状態」</p>
        </div>
        <div className="text-4xl text-slate-300">➡</div>
        <div className="text-center p-6 bg-blue-50 border-2 border-blue-200 rounded-xl w-1/3">
          <div className="text-6xl mb-4">🧪</div>
          <p className="font-bold text-lg text-blue-800">特定の働きを知るには<br/>「それだけ」を取り出す！</p>
        </div>
      </div>
      <div className="bg-yellow-50 border-l-8 border-yellow-400 p-6 rounded shadow-sm">
        <h3 className="font-bold text-xl text-yellow-800 mb-2">ここがポイント！</h3>
        <p className="text-lg">
          武器は<span className="font-bold text-red-500 text-2xl mx-2">「遠心力」</span>と<span className="font-bold text-red-500 text-2xl mx-2">「重さ（大きさ）」</span>だ！<br/>
          重いものほど、弱い力で早く沈むぞ。
        </p>
      </div>
    </div>
  );

  const Slide3 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-4 border-b-4 border-blue-200 pb-2 inline-block w-full">
        【最重要】実験前の「3つの誓い」
      </h2>
      <p className="text-slate-500 mb-6 text-lg">細胞を壊すときの「保存液」の条件（記述問題の鉄板！）</p>
      
      <div className="space-y-6">
        <div className="flex items-start bg-white p-4 rounded-lg shadow border border-slate-100">
          <div className="text-4xl mr-4">🧊</div>
          <div>
            <h3 className="text-xl font-bold text-slate-800">1. 低温（冷却）</h3>
            <p className="text-slate-600 mt-1">理由：酵素の働きを抑え、細胞小器官が<span className="font-bold text-red-500">自己消化</span>されるのを防ぐため。</p>
          </div>
        </div>
        
        <div className="flex items-start bg-white p-4 rounded-lg shadow border border-slate-100">
          <div className="text-4xl mr-4">⚖️</div>
          <div>
            <h3 className="text-xl font-bold text-slate-800">2. 等張（等張液）</h3>
            <p className="text-slate-600 mt-1">理由：吸水による<span className="font-bold text-red-500">破裂</span>や、脱水による<span className="font-bold text-red-500">変形（収縮）</span>を防ぐため。</p>
          </div>
        </div>

        <div className="flex items-start bg-white p-4 rounded-lg shadow border border-slate-100">
          <div className="text-4xl mr-4">🧪</div>
          <div>
            <h3 className="text-xl font-bold text-slate-800">3. 中性（緩衝液）</h3>
            <p className="text-slate-600 mt-1">理由：pHの変化による<span className="font-bold text-red-500">タンパク質の変性</span>を防ぐため。</p>
          </div>
        </div>
      </div>
    </div>
  );

  const Slide4 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-8 border-b-4 border-blue-200 pb-2 inline-block w-full">
        手順①：ホモジェナイザーで破砕
      </h2>
      <div className="flex items-center gap-8">
        <div className="w-1/3 flex justify-center">
           <div className="text-9xl">🔨💥</div>
        </div>
        <div className="w-2/3 space-y-6">
          <ul className="list-disc pl-6 space-y-4 text-xl text-slate-700">
            <li>細胞壁（植物の場合）などの硬い構造を壊す。</li>
            <li>細胞膜を破り、中身をドロドロのスープ状（<span className="font-bold text-blue-600">細胞破砕液</span>）にする。</li>
            <li className="text-red-500 font-bold">※やりすぎると細胞小器官（ミトコンドリアや核など）まで壊れるので注意！</li>
          </ul>
          <div className="bg-gray-100 p-4 rounded-lg text-center font-bold text-slate-600">
            細胞を「すりつぶす」工程 ＝ <span className="text-2xl text-blue-600">「ホモジェナイズ」</span>
          </div>
        </div>
      </div>
    </div>
  );

  const Slide5 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-2 border-b-4 border-blue-200 pb-2 inline-block w-full">
        手順②：遠心分離の法則
      </h2>
      <p className="text-center text-red-500 font-bold text-2xl mb-8">重いものから先に沈殿する！</p>
      
      <div className="flex justify-center gap-8">
        <div className="w-1/2 bg-blue-50 p-6 rounded-xl border-2 border-blue-200 flex flex-col items-center">
          <h3 className="text-xl font-bold text-blue-800 mb-4">低速・短時間</h3>
          <div className="text-8xl mb-4">🐘</div>
          <p className="text-center font-bold text-slate-700">
            重くて大きいものが沈む<br/>
            （例：核）
          </p>
        </div>
        
        <div className="w-1/2 bg-green-50 p-6 rounded-xl border-2 border-green-200 flex flex-col items-center">
          <h3 className="text-xl font-bold text-green-800 mb-4">高速・長時間</h3>
          <div className="text-8xl mb-4">🐇</div>
          <p className="text-center font-bold text-slate-700">
            軽くて小さいものが沈む<br/>
            （例：リボソーム）
          </p>
        </div>
      </div>
      
      <p className="text-center mt-8 text-slate-500 font-bold">
        【サイズ感のイメージ】 象 ＞ 馬 ＞ ウサギ
      </p>
    </div>
  );

  const Slide6 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-8 border-b-4 border-blue-200 pb-2 inline-block w-full">
        沈殿の順番（完全攻略チャート）
      </h2>
      
      <div className="space-y-4">
        <div className="flex items-center">
          <div className="w-24 font-bold text-slate-500">Step 1</div>
          <div className="flex-1 bg-slate-100 p-4 rounded-r-lg border-l-8 border-blue-500 flex justify-between items-center">
            <span>低速 (1000g)</span>
            <span className="font-bold text-2xl text-blue-700">核</span>
          </div>
        </div>
        <div className="flex justify-center text-slate-300 text-2xl">⬇ 上澄みをさらに遠心</div>
        
        <div className="flex items-center">
          <div className="w-24 font-bold text-slate-500">Step 2</div>
          <div className="flex-1 bg-slate-100 p-4 rounded-r-lg border-l-8 border-green-500 flex justify-between items-center">
            <span>中速 (3000g)</span>
            <span className="font-bold text-2xl text-green-700">葉緑体・ミトコンドリア</span>
          </div>
        </div>
        <div className="flex justify-center text-slate-300 text-2xl">⬇ 上澄みをさらに遠心</div>

        <div className="flex items-center">
          <div className="w-24 font-bold text-slate-500">Step 3</div>
          <div className="flex-1 bg-slate-100 p-4 rounded-r-lg border-l-8 border-yellow-500 flex justify-between items-center">
            <span>高速 (100000g)</span>
            <span className="font-bold text-2xl text-yellow-600">リボソーム・ミクロソーム</span>
          </div>
        </div>
        
        <div className="mt-4 text-center p-4 bg-gray-50 rounded-lg">
          残った上澄み液 ＝ <span className="font-bold text-xl text-slate-800">細胞質基質</span>
        </div>
      </div>
      
      <div className="absolute bottom-12 right-12 bg-white px-6 py-3 rounded-full shadow-lg border-2 border-red-400 transform -rotate-3">
        <span className="text-red-500 font-black text-xl">覚え方：「カク・ヨウ・ミ・リ」</span>
      </div>
    </div>
  );

  const Slide7 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-8 border-b-4 border-blue-200 pb-2 inline-block w-full">
        <span className="text-red-500">要注意！</span> ミクロソームって何？
      </h2>
      
      <div className="bg-white p-8 rounded-xl shadow-md border border-slate-200">
        <div className="flex items-start gap-6">
          <div className="text-5xl text-yellow-500">
            <Info />
          </div>
          <div className="space-y-6">
            <p className="text-xl text-slate-800">
              教科書や模試でいきなり出てくる謎の存在「ミクロソーム」。<br/>
              実はこれ、<span className="font-bold underline decoration-red-400 decoration-4">細胞内には元々存在しません！</span>
            </p>
            
            <ul className="list-disc pl-6 space-y-2 text-lg text-slate-600">
              <li>細胞を破砕した時にできる「断片」。</li>
              <li>主に<strong>小胞体</strong>や<strong>ゴルジ体</strong>などの膜構造がちぎれてできた小胞の集まり。</li>
              <li>リボソームと一緒に（またはその直前に）沈殿することが多い。</li>
            </ul>
            
            <div className="bg-blue-50 p-4 rounded text-center text-xl font-bold text-blue-800 mt-4">
              結論：「壊れた小胞体たちの残骸」と覚えておけばOK！
            </div>
          </div>
        </div>
      </div>
    </div>
  );

  const Slide8 = () => (
    <div className="flex flex-col h-full justify-center px-12">
      <h2 className="text-3xl font-bold text-blue-700 mb-8 border-b-4 border-blue-200 pb-2 inline-block w-full">
        確認問題（アウトプット）
      </h2>
      
      <div className="space-y-6">
        {/* Q1 */}
        <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
          <div className="flex justify-between items-center cursor-pointer" onClick={() => toggleAnswer(1)}>
            <h3 className="text-lg font-bold text-slate-800">Q1. ホモジェナイズする時、氷冷するのはなぜ？</h3>
            <button className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">答え</button>
          </div>
          {showAnswer[1] && (
            <div className="mt-3 pt-3 border-t border-slate-100 text-green-700 font-bold animate-fade-in">
              A. 酵素による自己消化を防ぐため。
            </div>
          )}
        </div>

        {/* Q2 */}
        <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
          <div className="flex justify-between items-center cursor-pointer" onClick={() => toggleAnswer(2)}>
            <h3 className="text-lg font-bold text-slate-800">Q2. ミトコンドリアとリボソーム、先に沈殿するのはどっち？</h3>
            <button className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">答え</button>
          </div>
          {showAnswer[2] && (
            <div className="mt-3 pt-3 border-t border-slate-100 text-green-700 font-bold animate-fade-in">
              A. ミトコンドリア（サイズが大きいから）。
            </div>
          )}
        </div>

        {/* Q3 */}
        <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
          <div className="flex justify-between items-center cursor-pointer" onClick={() => toggleAnswer(3)}>
            <h3 className="text-lg font-bold text-slate-800">Q3. 最後の上澄み液で起こっている化学反応（代謝）は何？</h3>
            <button className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">答え</button>
          </div>
          {showAnswer[3] && (
            <div className="mt-3 pt-3 border-t border-slate-100 text-green-700 font-bold animate-fade-in">
              A. 解糖系（細胞質基質だから）。
            </div>
          )}
        </div>
      </div>
    </div>
  );

  const Slide9 = () => (
    <div className="flex flex-col h-full justify-center items-center px-12 text-center">
      <h2 className="text-4xl font-black text-slate-800 mb-12">
        まとめ：今日のゴール
      </h2>
      
      <div className="grid grid-cols-1 gap-6 w-full max-w-2xl mb-12">
        <div className="bg-white p-6 rounded-xl shadow-md border-l-8 border-blue-500 flex items-center text-left">
          <CheckCircle className="text-blue-500 w-8 h-8 mr-4 flex-shrink-0" />
          <div className="text-xl font-bold text-slate-700">
            <span className="text-blue-600">条件3つ</span>（低温・等張・緩衝液）を理由とともに言える！
          </div>
        </div>
        
        <div className="bg-white p-6 rounded-xl shadow-md border-l-8 border-green-500 flex items-center text-left">
          <CheckCircle className="text-green-500 w-8 h-8 mr-4 flex-shrink-0" />
          <div className="text-xl font-bold text-slate-700">
            <span className="text-green-600">沈殿順</span>（核 ➡ 葉・ミト ➡ リボ ➡ 細胞質基質）が言える！
          </div>
        </div>
      </div>

      <div className="bg-yellow-400 text-white font-black text-2xl py-4 px-12 rounded-full shadow-lg transform rotate-2">
        細胞分画法を制する者は、細胞分野を制する！
      </div>
      <p className="mt-8 text-slate-400 font-bold">お疲れ様でした！</p>
    </div>
  );

  const slides = [Slide1, Slide2, Slide3, Slide4, Slide5, Slide6, Slide7, Slide8, Slide9];
  const CurrentSlideComponent = slides[currentSlide];

  // Lecturer Notes Content
  const lecturerNotes = [
    "さあ、今日もやっていきましょう！今日は細胞の中身をバラバラにして取り出す『細胞分画法』。手順や条件の理由記述、沈殿順序など入試の鉄板です。苦手意識を持たず、イメージで攻略しましょう！",
    "みんな、サラダの中から『トマトだけ』の味を調べたい時どうする？トマトだけ取り出すよね？細胞も同じ。中身をバラバラにして、欲しいパーツだけ取り出す技術、それが細胞分画法だ！",
    "ここは入試で死ぬほど書かされます。細胞を取り出す前に、細胞小器官が壊れたら意味がないよね？だから『冷やして・同じ濃さで・pHを変えない』。この3点セットは呪文のように覚えよう！",
    "まずは細胞をすり潰します。これをホモジェナイズと言います。イメージはミキサーだけど、優しくね。中のミトコンドリアまで壊しちゃったら元も子もないからね。",
    "バケツに水と石と砂を入れてグルグル回すと、重い石から先に外側に溜まるよね？あれと同じ。『デカくて重い奴から先に沈殿する』。これだけ分かれば勝ちだ！象＞馬＞ウサギのイメージで！",
    "『核・葉・ミ・リ』（カク・ヨウ・ミ・リ）の順だ！核が一番デカい。次は葉緑体とミトコンドリア。最後はリボソーム。残った汁が細胞質基質。この順番は絶対だぞ！",
    "教科書の図には載ってないのに、分画法の時だけ出てくる謎の『ミクロソーム』。これは『壊れた小胞体たちの残骸』だと思っておけばOK。これを知ってると偏差値が上がるよ。",
    "さあ、理解できたかチェックするぞ。答えのボタンを押す前に、自分の頭で考えてみてくれ！特に3番は、細胞小器官の働きを理解していないと解けない良問だ。",
    "細胞分画法は、細胞の構造と大きさを理解しているかのリトマス試験紙です。ここができれば細胞分野は怖いものなし！g（重力加速度）の数字は覚えなくていい、大事なのは『大小関係』と『順番』だ！お疲れ様でした！"
  ];

  return (
    <div className="bg-slate-200 min-h-screen p-8 flex flex-col items-center">
      {/* Slide Screen */}
      <div className="bg-white w-full max-w-[1024px] aspect-[4/3] rounded-xl shadow-2xl overflow-hidden relative flex flex-col">
        {/* Main Content Area */}
        <div className="flex-1 p-8 bg-slate-50">
          <CurrentSlideComponent />
        </div>

        {/* Lecturer Notes Area (Fixed at bottom of slide) */}
        <div className="bg-yellow-50 border-t border-yellow-200 p-4 h-24 overflow-y-auto">
          <div className="flex items-center gap-2 mb-1">
            <BookOpen size={16} className="text-yellow-700" />
            <span className="text-xs font-bold text-yellow-700 uppercase">講師用メモ（カンペ）</span>
          </div>
          <p className="text-sm text-slate-700 leading-relaxed">
            {lecturerNotes[currentSlide]}
          </p>
        </div>
      </div>

      {/* Control Panel */}
      <div className="mt-6 flex items-center gap-6 bg-white px-8 py-3 rounded-full shadow-lg">
        <button 
          onClick={prevSlide} 
          disabled={currentSlide === 0}
          className="p-2 rounded-full hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed transition"
        >
          <ChevronLeft size={32} className="text-blue-600" />
        </button>
        
        <div className="text-lg font-bold text-slate-700 w-32 text-center">
          {currentSlide + 1} / {totalSlides}
        </div>

        <button 
          onClick={nextSlide} 
          disabled={currentSlide === totalSlides - 1}
          className="p-2 rounded-full hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed transition"
        >
          <ChevronRight size={32} className="text-blue-600" />
        </button>
      </div>
      
      <p className="mt-4 text-slate-500 text-sm">
        ※キーボードの「←」「→」キーでも操作できます
      </p>
    </div>
  );
};

export default SlideDeck;
